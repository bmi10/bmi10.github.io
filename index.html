<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>500kcal</title>
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <h1 align="center" style="color: #EF6C00;font-size: 42px">500kcal</h1>
    <table style="margin: 0 auto;font-size: 20px">
        <tbody>
            <tr>
                <td>野菜一日これ一本</td>
                <td align="right">66kcal</td>
            </tr>
            <tr>
                <td>ナチュレ恵</td>
                <td align="right">43kcal</td>
            </tr>
            <tr>
                <td>サーディン</td>
                <td align="right">221kcal</td>
            </tr>
        </tbody>
    </table>
    <input placeholder="商品名\d{1,3}" onchange="changeHandler(this.value)">
    <script>
        function changeHandler(value) {
            const m = value.normalize('NFKC').match(/(?<name>.+?)(?<kcal>\d{1,3})$/)
            if (!m) return
            const groups = m.groups
            groups.kcal = parseInt(groups.kcal, 10)
            localStorage.setItem(Date.now(), JSON.stringify(groups))
            location.reload()
        }
        const h1 = document.querySelector('h1')
        function addItem([createdAt, json]) {
            const data = JSON.parse(json)
            const tr = document.createElement('tr')
            const td1 = tr.appendChild(document.createElement('td'))
            td1.textContent = data.name
            const td2 = tr.appendChild(document.createElement('td'))
            td2.textContent = data.kcal
            td2.align = 'right'
            document.querySelector('tbody').appendChild(tr)

            kcal = parseInt(h1.textContent.slice(0, -4), 10) + data.kcal
            h1.textContent = kcal + h1.textContent.slice(-4)
            if (kcal >= 1000) h1.style.color = '#F44336'
            else if (kcal >= 500) h1.style.color = '#EF6C00'
        }
        const today = new Date().toLocaleDateString('sv')
        Object.entries(localStorage).filter(([k]) => !isNaN(k) && new Date(parseInt(k, 10)).toLocaleDateString('sv') === today).forEach(addItem)
    </script>
</body>
</html>
