<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>食欲を抑える方法</title>
  <meta name="description" content="食欲を抑えるには、水をこまめに摂取しよう。">
  <link rel="shortcut icon" href="images/logo-32x32.png">
</head>

<body>
  <h1><output id="kcal"></output>kcal</h1>
  <h1>外食禁止</h1>
  <h1>エレベーター禁止</h1>
  <h1>食欲を抑える方法</h1>
  <h2>水をこまめに摂る🚰</h2>
  <h2>緑茶を飲む🍃</h2>
  <h2>炭酸水を飲む🥤</h2>
  <h2>日光を浴びる🌞</h2>
  <h2>歯磨き🪥</h2>
  <h2>寝る💤</h2>
  <h1>我慢できないとき</h1>
<script type="module">
const today = new Date().toLocaleDateString('sv')
const items = await fetch('https://docs.google.com/spreadsheets/d/1O9WfgSyzf3CGJFrgx_-Azw533VvaCyeW_OgxRBeeGgU/export?format=csv').then(r=>r.text()).then(csv => csv.split('\r\n').slice(1).map(line=>line.split(',')))
items.forEach(([name, kcal, tooltip]) => {
    const h2 = document.body.appendChild(document.createElement('h2'))
    h2.textContent = name
    h2.addEventListener('click', async () => {
        fetch('https://waist3-default-rtdb.asia-southeast1.firebasedatabase.app/.json', {method: 'POST', body: JSON.stringify({name, kcal: parseInt(kcal, 10), createdAt: Date.now()})})
        document.all.kcal.value = parseInt(document.all.kcal.value, 10) + parseInt(kcal, 10)
        fetch('https://push14-default-rtdb.asia-southeast1.firebasedatabase.app/k.json', {method: 'PUT', body: document.all.kcal.value})
    })
})
document.all.kcal.value = Object.values(await fetch('https://waist3-default-rtdb.asia-southeast1.firebasedatabase.app/.json').then(r=>r.json())).filter(({createdAt}) => new Date(createdAt).toLocaleDateString('sv') === today).map(i=>i.kcal).reduce((a,b) => a+b, 0)
</script>
</body>

</html>
