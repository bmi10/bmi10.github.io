<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>é£Ÿæ¬²ã‚’æŠ‘ãˆã‚‹æ–¹æ³•</title>
  <meta name="description" content="é£Ÿæ¬²ã‚’æŠ‘ãˆã‚‹ã«ã¯ã€æ°´ã‚’ã“ã¾ã‚ã«æ‘‚å–ã—ã‚ˆã†ã€‚">
  <meta name="theme-color" content="#4285f4">
  <link rel="shortcut icon" href="images/logo-32x32.png">
</head>

<body>
  <h1><output id="kcal"></output>kcal</h1>
  <h1>å¤–é£Ÿç¦æ­¢</h1>
  <h1>ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼ç¦æ­¢</h1>
  <h1>é£Ÿæ¬²ã‚’æŠ‘ãˆã‚‹æ–¹æ³•</h1>
  <h2>æ°´ã‚’ã“ã¾ã‚ã«æ‘‚ã‚‹ğŸš°</h2>
  <h2>ç·‘èŒ¶ã‚’é£²ã‚€ğŸƒ</h2>
  <h2>ç‚­é…¸æ°´ã‚’é£²ã‚€ğŸ¥¤</h2>
  <h2>æ—¥å…‰ã‚’æµ´ã³ã‚‹ğŸŒ</h2>
  <h2>æ­¯ç£¨ãğŸª¥</h2>
  <h2>å¯ã‚‹ğŸ’¤</h2>
  <h1>æˆ‘æ…¢ã§ããªã„ã¨ã</h1>
<script type="module">
  function updateTheme() {
    if (document.all.kcal.value >= 500) document.body.style.background = 'orange'
    if (document.all.kcal.value >= 1000) document.body.style.background = 'red'
  }
  const today = new Date().toLocaleDateString('sv')
  fetch('https://waist3-default-rtdb.asia-southeast1.firebasedatabase.app/.json').then(r=>r.json()).then(r => {
    document.all.kcal.value = Object.values(r).filter(({createdAt}) => new Date(createdAt).toLocaleDateString('sv') === today).map(i=>i.kcal).reduce((a,b) => a+b, 0)
    updateTheme()
  })
  const items = await fetch('https://docs.google.com/spreadsheets/d/1O9WfgSyzf3CGJFrgx_-Azw533VvaCyeW_OgxRBeeGgU/export?format=csv').then(r=>r.text()).then(csv => csv.split('\r\n').slice(1).map(line=>line.split(',')))
  items.forEach(([name, kcal, tooltip]) => {
    const h2 = document.body.appendChild(document.createElement('h2'))
    h2.textContent = name
    h2.addEventListener('click', async () => {
      fetch('https://waist3-default-rtdb.asia-southeast1.firebasedatabase.app/.json', {method: 'POST', body: JSON.stringify({name, kcal: parseInt(kcal, 10), createdAt: Date.now()})})
      document.all.kcal.value = parseInt(document.all.kcal.value, 10) + parseInt(kcal, 10)
      fetch('https://push14-default-rtdb.asia-southeast1.firebasedatabase.app/k.json', {method: 'PUT', body: document.all.kcal.value})
      updateTheme()
    })
  })
</script>
</body>

</html>
